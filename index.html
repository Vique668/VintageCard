
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–í–∏–Ω—Ç–∞–∂–Ω–∞—è –æ—Ç–∫—Ä—ã—Ç–∫–∞ ‚Äî –° –ù–æ–≤—ã–º –ì–æ–¥–æ–º!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: #fdfaf6; 
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
        }
        .font-vintage { font-family: 'Marck Script', cursive; }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        @keyframes snowfall {
            0% { transform: translateY(-10px) rotate(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            pointer-events: none;
            z-index: 0;
            animation: snowfall linear infinite;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@1.34.0",
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "vite": "https://esm.sh/vite@^7.3.0",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        const Header = () => (
            <header className="relative z-10 py-10 text-center">
                <div className="container mx-auto px-4">
                    <div className="inline-block relative">
                        <span className="absolute -left-12 top-0 text-4xl animate-bounce">‚ùÑÔ∏è</span>
                        <h1 className="text-5xl md:text-7xl font-vintage text-red-700 drop-shadow-xl mb-2">
                            –° –ù–æ–≤—ã–º –≥–æ–¥–æ–º!
                        </h1>
                        <span className="absolute -right-12 top-0 text-4xl animate-bounce delay-100">üå≤</span>
                    </div>
                    <p className="text-slate-500 text-[10px] font-bold tracking-[0.5em] uppercase mt-4">
                        –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–∞–∂–Ω—ã—Ö –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π
                    </p>
                </div>
            </header>
        );

        const App = () => {
            const [images, setImages] = useState([]);
            const [isGenerating, setIsGenerating] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const fileInputRef = useRef(null);

            const onFileChange = (e) => {
                const files = Array.from(e.target.files || []);
                const remainingSlots = 3 - images.length;
                files.slice(0, remainingSlots).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        setImages(prev => [...prev, ev.target.result]);
                        setError(null);
                    };
                    reader.readAsDataURL(file);
                });
            };

            const generate = async () => {
                if (images.length === 0) return;
                
                if (!process.env.API_KEY || process.env.API_KEY === "") {
                    setError("API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω. –ù–∞ GitHub Pages –µ–≥–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ Secrets –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.");
                    return;
                }

                setIsGenerating(true);
                setError(null);

                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    
                    const imageParts = images.map(url => ({
                        inlineData: {
                            data: url.split(',')[1],
                            mimeType: url.split(',')[0].split(':')[1].split(';')[0]
                        }
                    }));

                    const prompt = `Soviet New Year greeting card from 1960s-1970s. 
                    Feature the exact people from the photos. 
                    Classic gouache illustration style. 
                    Warm festive atmosphere, snowy background with a decorated fir tree. 
                    People wearing stylish vintage winter clothes (woolen coats, fur hats, scarves). 
                    The scene should be joyful and nostalgic. 
                    Maintain high facial likeness. 
                    No text in the image itself.`;

                    const response = await ai.models.generateContent({
                        model: 'gemini-2.5-flash-image',
                        contents: { parts: [...imageParts, { text: prompt }] },
                        config: { 
                            imageConfig: { 
                                aspectRatio: "9:16"
                            } 
                        }
                    });

                    let base64 = "";
                    const parts = response.candidates?.[0]?.content?.parts || [];
                    for (const p of parts) {
                        if (p.inlineData) {
                            base64 = `data:image/png;base64,${p.inlineData.data}`;
                            break;
                        }
                    }

                    if (base64) {
                        const finalCard = await applyPostcardEffects(base64);
                        setResult(finalCard);
                    } else {
                        throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                    }
                } catch (err) {
                    console.error(err);
                    setError(err.message || "–û—à–∏–±–∫–∞ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–∞.");
                } finally {
                    setIsGenerating(false);
                }
            };

            const applyPostcardEffects = (base64) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.crossOrigin = "anonymous";
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);

                        const fontSize = Math.floor(canvas.width * 0.13);
                        ctx.font = `${fontSize}px 'Marck Script'`;
                        ctx.textAlign = 'center';
                        const text = "–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º!";
                        const x = canvas.width / 2;
                        const y = canvas.height * 0.15;

                        ctx.shadowColor = 'rgba(0,0,0,0.5)';
                        ctx.shadowBlur = 10;
                        ctx.shadowOffsetX = 3;
                        ctx.shadowOffsetY = 3;

                        ctx.strokeStyle = '#8b0000';
                        ctx.lineWidth = fontSize * 0.08;
                        ctx.strokeText(text, x, y);

                        const goldGrad = ctx.createLinearGradient(0, y - fontSize, 0, y);
                        goldGrad.addColorStop(0, '#fff6e0');
                        goldGrad.addColorStop(1, '#ffcc33');
                        ctx.fillStyle = goldGrad;
                        ctx.shadowColor = 'transparent';
                        ctx.fillText(text, x, y);

                        // Texture
                        ctx.globalCompositeOperation = 'multiply';
                        ctx.globalAlpha = 0.03;
                        for (let i = 0; i < 5000; i++) {
                            const rx = Math.random() * canvas.width;
                            const ry = Math.random() * canvas.height;
                            ctx.fillStyle = '#000';
                            ctx.fillRect(rx, ry, 1, 1);
                        }

                        resolve(canvas.toDataURL('image/png'));
                    };
                    img.src = base64;
                });
            };

            const reset = () => {
                setResult(null);
                setImages([]);
                setError(null);
            };

            return (
                <div className="min-h-screen flex flex-col relative">
                    <Header />
                    
                    <main className="container mx-auto px-4 pb-20 max-w-5xl flex-grow z-10">
                        {result ? (
                            <div className="max-w-lg mx-auto animate-in fade-in zoom-in duration-500">
                                <div className="bg-white p-6 rounded-[2rem] shadow-2xl border-8 border-white">
                                    <img src={result} className="w-full h-auto rounded-xl shadow-inner" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç" />
                                    <div className="mt-8 flex flex-col sm:flex-row gap-4">
                                        <button onClick={() => {
                                            const a = document.createElement('a');
                                            a.href = result;
                                            a.download = `soviet_card_${Date.now()}.png`;
                                            a.click();
                                        }} className="flex-1 py-4 bg-red-600 text-white rounded-2xl font-bold text-lg hover:bg-red-700 shadow-lg active:scale-95 flex items-center justify-center gap-2">
                                            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                        </button>
                                        <button onClick={reset} className="flex-1 py-4 bg-slate-100 text-slate-500 rounded-2xl font-bold text-lg hover:bg-slate-200 active:scale-95">
                                            üîÑ –°–¥–µ–ª–∞—Ç—å –Ω–æ–≤—É—é
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="grid lg:grid-cols-2 gap-10 items-start">
                                <div className="glass-card p-10 rounded-[3rem] shadow-2xl">
                                    <h2 className="text-3xl font-extrabold text-slate-800 mb-6">–°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç–∫—É ‚ú®</h2>
                                    <p className="text-slate-600 leading-relaxed mb-10">
                                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ù–∞—à –ò–ò —Å–æ–∑–¥–∞—Å—Ç –∏–∑ –Ω–∏—Ö –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –Ω–æ–≤–æ–≥–æ–¥–Ω—é—é –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—é –≤ —Å—Ç–∏–ª–µ 60-—Ö.
                                    </p>

                                    <div 
                                        onClick={() => fileInputRef.current?.click()}
                                        className="relative group w-full border-4 border-dashed border-red-100 rounded-[2.5rem] p-16 text-center cursor-pointer hover:border-red-400 hover:bg-red-50/50 transition-all"
                                    >
                                        <div className="text-7xl mb-6 group-hover:scale-110 transition-transform">üì∏</div>
                                        <p className="font-bold text-slate-700 text-lg">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</p>
                                        <input type="file" ref={fileInputRef} onChange={onFileChange} multiple accept="image/*" className="hidden" />
                                    </div>

                                    {images.length > 0 && (
                                        <div className="mt-10 flex flex-wrap gap-4 justify-center">
                                            {images.map((img, i) => (
                                                <div key={i} className="relative w-24 h-24">
                                                    <img src={img} className="w-full h-full object-cover rounded-2xl ring-4 ring-white shadow-xl" />
                                                    <button onClick={() => setImages(prev => prev.filter((_, idx) => idx !== i))} className="absolute -top-3 -right-3 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg hover:bg-red-600 transition-all">√ó</button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="h-full">
                                    <div className="glass-card p-12 rounded-[3rem] shadow-2xl min-h-[500px] flex flex-col items-center justify-center text-center">
                                        {isGenerating ? (
                                            <div className="space-y-10 w-full">
                                                <div className="relative w-32 h-32 mx-auto">
                                                    <div className="absolute inset-0 border-8 border-slate-100 rounded-full"></div>
                                                    <div className="absolute inset-0 border-8 border-t-red-600 rounded-full animate-spin"></div>
                                                    <div className="absolute inset-0 flex items-center justify-center text-4xl">ü™Ñ</div>
                                                </div>
                                                <div>
                                                    <p className="text-3xl font-black text-slate-800">–ú–∞–≥–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...</p>
                                                    <p className="text-sm text-slate-400 mt-4 italic max-w-xs mx-auto">
                                                        –†–∏—Å—É–µ–º –≤–∏–Ω—Ç–∞–∂–Ω—ã–µ –∫–æ—Å—Ç—é–º—ã –∏ –∑–∏–º–Ω—é—é —Å–∫–∞–∑–∫—É. –≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ.
                                                    </p>
                                                </div>
                                            </div>
                                        ) : images.length > 0 ? (
                                            <div className="w-full space-y-10">
                                                <button onClick={generate} className="w-full py-8 bg-red-600 text-white rounded-[2.5rem] font-black text-3xl hover:bg-red-700 hover:scale-[1.02] transition-all shadow-2xl shadow-red-200 active:scale-95 flex items-center justify-center gap-4">
                                                    <span>–°–û–ó–î–ê–¢–¨</span>
                                                    <span>üéÑ</span>
                                                </button>
                                                <p className="text-[10px] text-slate-300 uppercase tracking-widest font-bold">Powered by Gemini 2.5 Flash</p>
                                            </div>
                                        ) : (
                                            <div className="opacity-20 flex flex-col items-center">
                                                <div className="text-[10rem] mb-4">üéÖ</div>
                                                <p className="text-2xl font-bold text-slate-400">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–∏ –ª—É—á—à–∏–µ —Ñ–æ—Ç–æ</p>
                                            </div>
                                        )}
                                        
                                        {error && (
                                            <div className="mt-10 p-5 bg-red-50 text-red-600 rounded-3xl text-sm font-bold border border-red-100 w-full">
                                                ‚ö†Ô∏è {error}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="py-12 text-center text-slate-400 text-xs bg-white/50 border-t border-slate-100 z-10">
                        <p className="font-bold mb-2">¬© 2024 –†–µ—Ç—Ä–æ-—Ñ–æ—Ç–æ–º–∞—Å—Ç–µ—Ä—Å–∫–∞—è</p>
                        <p className="opacity-50 italic uppercase tracking-widest text-[8px]">Static Deployment Ready ‚Ä¢ AI Assisted</p>
                    </footer>

                    {[...Array(15)].map((_, i) => (
                        <div key={i} className="snowflake" style={{
                            left: `${Math.random() * 100}%`,
                            animationDuration: `${Math.random() * 5 + 5}s`,
                            animationDelay: `${Math.random() * 5}s`,
                            fontSize: `${Math.random() * 10 + 10}px`
                        }}>‚Ä¢</div>
                    ))}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
