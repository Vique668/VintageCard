
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–í–∏–Ω—Ç–∞–∂–Ω–∞—è –æ—Ç–∫—Ä—ã—Ç–∫–∞ ‚Äî –° –ù–æ–≤—ã–º –ì–æ–¥–æ–º!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Marck+Script&family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #fdfaf6; }
        .font-vintage { font-family: 'Marck Script', cursive; }
        .card-shadow { shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
    </style>
    <script>
        window.process = { env: { API_KEY: "" } };
    </script>
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "vite": "https://esm.sh/vite@^7.3.0",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
        const blobToBase64 = (blob) => new Promise((res) => {
            const reader = new FileReader();
            reader.onloadend = () => res(reader.result);
            reader.readAsDataURL(blob);
        });

        // --- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ---

        const Header = () => (
            <header className="bg-white border-b border-slate-100 py-8 shadow-sm">
                <div className="container mx-auto px-4 text-center">
                    <div className="inline-flex items-center space-x-4 mb-2">
                        <span className="text-4xl">‚ùÑÔ∏è</span>
                        <h1 className="text-5xl font-vintage text-red-700 drop-shadow-md">–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º!</h1>
                        <span className="text-4xl">üå≤</span>
                    </div>
                    <p className="text-slate-400 text-[11px] font-bold tracking-[0.4em] uppercase">–°–æ–≤–µ—Ç—Å–∫–∞—è —ç—Å—Ç–µ—Ç–∏–∫–∞ ‚Ä¢ –ú–∞–≥–∏—è –ò–ò</p>
                </div>
            </header>
        );

        const Footer = () => (
            <footer className="py-12 bg-white mt-auto border-t border-slate-50 text-center">
                <p className="text-slate-400 text-sm font-medium">¬© 2024 –†–µ—Ç—Ä–æ-—Ñ–æ—Ç–æ–º–∞—Å—Ç–µ—Ä—Å–∫–∞—è</p>
                <div className="mt-4 flex justify-center space-x-4 opacity-30 text-xs grayscale">
                    <span>–ì–∞—Ä–º–æ–Ω–∏—è</span>
                    <span>‚Ä¢</span>
                    <span>–ù–æ—Å—Ç–∞–ª—å–≥–∏—è</span>
                    <span>‚Ä¢</span>
                    <span>–†–∞–¥–æ—Å—Ç—å</span>
                </div>
            </footer>
        );

        const App = () => {
            const [images, setImages] = useState([]);
            const [isGenerating, setIsGenerating] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const fileInputRef = useRef(null);

            const onFileChange = (e) => {
                const files = Array.from(e.target.files || []);
                files.forEach(file => {
                    if (images.length >= 3) return;
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        setImages(prev => [...prev, ev.target.result].slice(0, 3));
                        setError(null);
                    };
                    reader.readAsDataURL(file);
                });
            };

            const generate = async () => {
                if (images.length === 0) return;
                setIsGenerating(true);
                setError(null);

                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const imageParts = images.map(url => ({
                        inlineData: {
                            data: url.split(',')[1],
                            mimeType: url.split(',')[0].split(':')[1].split(';')[0]
                        }
                    }));

                    const prompt = "–°–æ–∑–¥–∞–π –≤–∏–Ω—Ç–∞–∂–Ω—É—é —Å–æ–≤–µ—Ç—Å–∫—É—é –Ω–æ–≤–æ–≥–æ–¥–Ω—é—é –æ—Ç–∫—Ä—ã—Ç–∫—É 1960-—Ö –≥–æ–¥–æ–≤. –ù–∞ –æ—Ç–∫—Ä—ã—Ç–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω—ã –¢–û–õ–¨–ö–û –ª—é–¥–∏ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–µ—Ç—ã –≤ –∑–∏–º–Ω—é—é –æ–¥–µ–∂–¥—É —Ç–æ–π —ç–ø–æ—Ö–∏ (–ø–∞–ª—å—Ç–æ, —à–∞—Ä—Ñ—ã, —à–∞–ø–∫–∏-—É—à–∞–Ω–∫–∏). –§–æ–Ω: —Å–∫–∞–∑–æ—á–Ω—ã–π –∑–∞—Å–Ω–µ–∂–µ–Ω–Ω—ã–π –ª–µ—Å, –Ω–∞—Ä—è–∂–µ–Ω–Ω–∞—è –µ–ª–∫–∞ —Å —Å–æ–≤–µ—Ç—Å–∫–∏–º–∏ –∏–≥—Ä—É—à–∫–∞–º–∏. –°—Ç–∏–ª—å: —Ç–µ–ø–ª–∞—è –≥—É–∞—à—å, –º—è–≥–∫–∏–µ —Ü–≤–µ—Ç–∞, –Ω–æ—Å—Ç–∞–ª—å–≥–∏—á–µ—Å–∫–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞. –õ–∏—Ü–∞ –ª—é–¥–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ—Ö–æ–∂–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—ã. –°–≤–µ—Ä—Ö—É –æ—Å—Ç–∞–≤—å –º–µ—Å—Ç–æ –¥–ª—è –Ω–∞–¥–ø–∏—Å–∏.";

                    const response = await ai.models.generateContent({
                        model: 'gemini-2.5-flash-image',
                        contents: { parts: [...imageParts, { text: prompt }] },
                        config: { imageConfig: { aspectRatio: "9:16" } }
                    });

                    let base64 = "";
                    const parts = response.candidates?.[0]?.content?.parts || [];
                    for (const p of parts) {
                        if (p.inlineData) {
                            base64 = `data:image/png;base64,${p.inlineData.data}`;
                            break;
                        }
                    }

                    if (base64) {
                        // –ù–∞–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Canvas
                        const finalBase64 = await addVintageText(base64);
                        setResult(finalBase64);
                    } else {
                        throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");
                    }
                } catch (err) {
                    setError(err.message || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞");
                } finally {
                    setIsGenerating(false);
                }
            };

            const addVintageText = (base64) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);

                        const fontSize = Math.floor(canvas.width * 0.12);
                        ctx.font = `${fontSize}px 'Marck Script'`;
                        ctx.textAlign = 'center';
                        
                        const text = "–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º!";
                        const x = canvas.width / 2;
                        const y = canvas.height * 0.14;

                        ctx.shadowColor = 'rgba(0,0,0,0.5)';
                        ctx.shadowBlur = 10;
                        ctx.strokeStyle = '#800000';
                        ctx.lineWidth = fontSize * 0.05;
                        ctx.strokeText(text, x, y);

                        const grad = ctx.createLinearGradient(0, y - fontSize, 0, y);
                        grad.addColorStop(0, '#fff49c');
                        grad.addColorStop(1, '#ffcc00');
                        ctx.fillStyle = grad;
                        ctx.fillText(text, x, y);

                        resolve(canvas.toDataURL('image/png'));
                    };
                    img.src = base64;
                });
            };

            const download = () => {
                const a = document.createElement('a');
                a.href = result;
                a.download = 'new_year_card.png';
                a.click();
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <Header />
                    <main className="container mx-auto px-4 py-12 max-w-5xl flex-grow">
                        {result ? (
                            <div className="max-w-md mx-auto animate-fade-in">
                                <div className="bg-white p-4 rounded-3xl shadow-2xl border border-slate-100">
                                    <img src={result} className="w-full h-auto rounded-2xl shadow-inner border-4 border-white" alt="Result" />
                                    <div className="mt-6 space-y-3">
                                        <button onClick={download} className="w-full py-4 bg-red-600 text-white rounded-2xl font-bold hover:bg-red-700 transition-all shadow-lg active:scale-95">–°–∫–∞—á–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∫—É</button>
                                        <button onClick={() => {setResult(null); setImages([]);}} className="w-full py-3 text-slate-400 font-semibold hover:text-slate-600 transition-colors">–°–æ–∑–¥–∞—Ç—å –¥—Ä—É–≥—É—é</button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="grid md:grid-cols-2 gap-12 items-center">
                                <div className="space-y-8">
                                    <div className="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-50">
                                        <h2 className="text-3xl font-extrabold text-slate-800 mb-4 tracking-tight">–°–æ–∑–¥–∞–π—Ç–µ —á—É–¥–æ ‚ú®</h2>
                                        <p className="text-slate-500 leading-relaxed mb-8">
                                            –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ú—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–º –≤–∞—Å –∏ –≤–∞—à–∏—Ö –±–ª–∏–∑–∫–∏—Ö –≤ —É—é—Ç–Ω—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —Å–æ–≤–µ—Ç—Å–∫–æ–≥–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞.
                                        </p>

                                        <div 
                                            onClick={() => fileInputRef.current?.click()}
                                            className="w-full border-4 border-dashed border-slate-100 rounded-[2rem] p-12 text-center cursor-pointer hover:border-red-200 hover:bg-red-50 transition-all group"
                                        >
                                            <div className="text-5xl mb-4 group-hover:scale-110 transition-transform duration-300">üì∏</div>
                                            <p className="font-bold text-slate-600">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</p>
                                            <p className="text-xs text-slate-400 mt-2 italic">–ú–∞–∫—Å–∏–º—É–º 3 —Å–Ω–∏–º–∫–∞</p>
                                            <input type="file" ref={fileInputRef} onChange={onFileChange} multiple accept="image/*" className="hidden" />
                                        </div>

                                        <div className="flex gap-4 mt-8 justify-center">
                                            {images.map((img, i) => (
                                                <div key={i} className="relative w-20 h-20 group">
                                                    <img src={img} className="w-full h-full object-cover rounded-2xl ring-4 ring-white shadow-md" />
                                                    <button onClick={() => setImages(prev => prev.filter((_, idx) => idx !== i))} className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 text-xs flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg">√ó</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="h-full flex flex-col justify-center">
                                    <div className="bg-white p-10 rounded-[2.5rem] shadow-2xl border border-slate-50 min-h-[450px] flex flex-col items-center justify-center text-center">
                                        {isGenerating ? (
                                            <div className="space-y-8 animate-pulse">
                                                <div className="w-24 h-24 border-8 border-slate-50 border-t-red-500 rounded-full animate-spin mx-auto"></div>
                                                <p className="text-2xl font-bold text-slate-800">–†–∏—Å—É–µ–º –≤–∞—à—É –∏—Å—Ç–æ—Ä–∏—é...</p>
                                                <p className="text-sm text-slate-400 max-w-xs mx-auto italic">–≠—Ç–æ –∑–∞–π–º–µ—Ç –æ–∫–æ–ª–æ 10-15 —Å–µ–∫—É–Ω–¥. –ú—ã –ø—Ä–æ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –¥–µ—Ç–∞–ª—å –æ—Ç–∫—Ä—ã—Ç–∫–∏.</p>
                                            </div>
                                        ) : images.length > 0 ? (
                                            <div className="w-full space-y-8">
                                                <div className="bg-red-50 p-6 rounded-3xl border border-red-100 inline-block">
                                                    <p className="text-red-700 font-bold">–í—ã–±—Ä–∞–Ω–æ —Ñ–æ—Ç–æ: {images.length}</p>
                                                </div>
                                                <button onClick={generate} className="w-full py-6 bg-red-600 text-white rounded-[2rem] font-black text-2xl hover:bg-red-700 hover:scale-[1.03] transition-all shadow-2xl shadow-red-200 active:scale-95 flex items-center justify-center space-x-4">
                                                    <span>–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨</span>
                                                    <span>‚ú®</span>
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="opacity-20 flex flex-col items-center">
                                                <div className="text-8xl mb-4">üéÑ</div>
                                                <p className="text-xl font-bold">–û–∂–∏–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ</p>
                                            </div>
                                        )}
                                        {error && <div className="mt-8 p-4 bg-red-50 text-red-600 rounded-2xl text-xs font-bold border border-red-100 w-full">{error}</div>}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    <Footer />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
